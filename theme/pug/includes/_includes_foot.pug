script(src=`${site.url.path}/assets/pjax-api.min.js`)
script.
  var Pjax = require('pjax-api').Pjax;
  new Pjax({  areas: ['#main', 'body'], update: { head: 'meta' }  });

script.
  var current_locale = "#{locale}";
  var user_language = window.navigator.language.slice(0, 2);
  var locales = !{JSON.stringify(site.locales)};
  var permalink = "#{page.meta.permalink.slice(locale.length + 1)}";

  if (window.location.search.indexOf('moved') == -1){
    if (locales.indexOf(user_language) >= 0){
      if(user_language != current_locale) Pjax.replace("/" + user_language + permalink + "?moved", {});
    } else { Pjax.replace("/ja/" + permalink + "?moved", {}); }
  } else {
    history.replaceState(null, null, window.location.href.replace(/\?.*$/,""));
  }

if(site.disqus)
  script
    | (function() {var d = document, s = d.createElement('script');s.src = 'https://#{site.disqus}.disqus.com/embed.js';s.setAttribute('data-timestamp', +new Date());(d.head || d.body).appendChild(s);})();
